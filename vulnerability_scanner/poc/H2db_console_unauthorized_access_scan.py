from Common.Common_Request import common_request
from Modules.Configure import ServerJ


class Basic_information:
    no = 97,
    bugName = 'H2db console 未授权访问漏洞'


def scan_H2db_console_unauthorized_access(url, proxies, append_to_output, serverJ_key, bugName):
    path = "/login.jsp?jsessionid=c3a385eefb360d01eb965b35795d93de"

    headers = {
        "User-Agent": "Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1)",
        "Accept": "*/*",
        "Connection": "close",
        "Accept-Language": "en",
        "Accept-Encoding": "gzip,deflate"
    }
    response1 = common_request(url, path, headers, method='GET', timeout=5, proxies=proxies,
                               append_to_output=append_to_output)
    if response1 is not None:
        if response1.status_code == 200 and "Connect" in response1.text:
            append_to_output(f"[+] {url} 可能存在{bugName}！！！！", "yellow")
            append_to_output(f"[+] {url} 存在{bugName}！！！！", "red")
            ServerJ.sc_send(bugName, f"漏洞连接: {url}\r ", ServerJ_Key=serverJ_key)
        else:
            append_to_output(f"[-] {url} 不存在{bugName}", "green")
